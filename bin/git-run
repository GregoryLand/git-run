#!/usr/bin/env ruby
require_relative '../lib/git_run'
require 'optparse'

OptionParser.new do |opts|
  opts.banner = "Usage: git run [options] <revision> <command>"

  opts.on("-h", "--help", "Show this message") do
    puts opts
    exit
  end

  if opts.default_argv.length < 2
    puts opts
    exit
  end
end.parse!

revision = ARGV.shift

begin
  print GitRun.run(revision, ARGV.join(' '))
rescue Rugged::RepositoryError
  $stderr.puts "#{Dir.pwd} is not a git repository."
rescue Rugged::ReferenceError
  $stderr.puts "'#{revision}' is not a revision in this repository."
rescue GitRun::DirtyRepositoryError
  $stderr.puts "The repository at #{Dir.pwd} is in a dirty state."
end
